<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>é¹½é¡å¯¦é©—å®¤</title>
<!-- Orbitron å­—å‹ -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<style>
body {
  background: linear-gradient(135deg, #10181a 0%, #1a2324 100%);
  color: #aee6e6;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
  margin: 0;
  padding: 20px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.game-title {
  font-size: 2.5em;
  margin-bottom: 10px;
  color: #aee6e6;
  letter-spacing: 2px;
  text-shadow: 0 2px 8px #223, 0 0px 1px #fff2;
  background: linear-gradient(90deg, #aee6e6 40%, #f7c873 60%, #aee6e6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
.neon-btn, .upgrade .neon-btn {
  background: linear-gradient(90deg, #1a2324 60%, #2e1a24 100%);
  border: 2px solid #7fd7d7;
  color: #aee6e6;
  box-shadow: 0 0 8px #7fd7d733, 0 0 0 #fff0;
  transition: background 0.2s, border 0.2s, color 0.2s;
  border-radius: 8px;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
.neon-btn:hover:not(:disabled) {
  background: linear-gradient(90deg, #223233 60%, #3a2333 100%);
  border-color: #f7c873;
  color: #f7c873;
}
.neon-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  border-color: #444;
}
.display {
  background: linear-gradient(90deg, #142024b0 60%, #24241ab0 100%);
  border: 1px solid #7fd7d7;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 8px;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
  font-size: 1.15em;
  /* æ–°å¢å‹•ç•« */
  animation: fadeInDisplay 0.7s;
}
@keyframes fadeInDisplay {
  from { opacity: 0; transform: translateY(-20px);}
  to { opacity: 1; transform: translateY(0);}
}
/* çµ±ä¸€è³‡æºé¢æ¿å­—å‹å¤§å° */
#currency-row span,
#currency-row #saltPpm,
#currency-row #waterVolume,
#currency-row #expPoints,
#currency-row #research,
#currency-row #saltTotal {
  font-size: 1.15em !important;
  vertical-align: middle;
  /* â†“â†“â†“ æ–°å¢ â†“â†“â†“ */
  margin-right: 0.2em;
  margin-left: 0.1em;
}
#currency-row {
  font-size: 1.15em;
  letter-spacing: 0.5px;
}
#saltPpm, #waterVolume, #expPoints, #research, #saltTotal {
  font-variant-numeric: tabular-nums;
  font-family: 'Consolas', 'Menlo', 'Monaco', monospace;
  letter-spacing: 0.01em; /* åŸæœ¬ 0.03emï¼Œæ”¹å° */
  min-width: 5.5em;       /* åŸæœ¬ 7.5emï¼Œæ”¹å° */
  display: inline-block;
  text-align: right;
  font-size: 1.3em;       /* åŸæœ¬ 1.5emï¼Œæ”¹å° */
  line-height: 1.2;
  vertical-align: middle;
  transition: color 0.3s;
  margin-right: 0.2em;    /* æ–°å¢ï¼Œç¸®å°é–“è· */
  margin-left: 0.1em;
}
#saltPpm.animated, #waterVolume.animated, #expPoints.animated, #research.animated, #saltTotal.animated {
  color: #f7c873;
  animation: popNum 0.4s;
}
@keyframes popNum {
  0% { color: #fff; transform: scale(1);}
  30% { color: #f7c873; transform: scale(1.18);}
  100% { color: #f7c873; transform: scale(1);}
}
/* å‡ç´šæŒ‰éˆ•å‹•ç•«èˆ‡é«˜äº® */
.upgrade .neon-btn {
  text-align: left;
  padding: 10px;
  margin: 5px 0;
  width: 100%;
  transition: box-shadow 0.2s, border-color 0.2s, background 0.2s;
  box-shadow: 0 0 12px #7fd7d755, 0 2px 8px #223b;
  position: relative;
  overflow: hidden;
}
.upgrade .neon-btn:active {
  box-shadow: 0 0 24px #f7c87399, 0 2px 8px #223b;
  border-color: #f7c873;
  background: linear-gradient(90deg, #2e1a24 60%, #1a2324 100%);
}
.upgrade .neon-btn.upgraded {
  border-color: #f7c873;
  box-shadow: 0 0 24px #f7c87399, 0 2px 8px #223b;
  animation: upgradeFlash 0.5s;
}
@keyframes upgradeFlash {
  0% { box-shadow: 0 0 0 #f7c87300;}
  50% { box-shadow: 0 0 32px #f7c873cc;}
  100% { box-shadow: 0 0 24px #f7c87399;}
}
/* å†·å»åœˆå‹•ç•«ä¿®æ­£ */
.cooldown-ring {
  width: 60px;
  height: 60px;
  position: relative;
  /* ä¿®æ­£ç‚ºåœ“å½¢ pulse */
  animation: pulseRingCircle 1.5s infinite alternate;
  border-radius: 50%;
}
@keyframes pulseRingCircle {
  0% { box-shadow: 0 0 0 0 #7fd7d700; }
  100% { box-shadow: 0 0 24px 8px #7fd7d7cc; }
}
.cooldown-ring .progress {
  stroke: #7fd7d7;
  transition: stroke-dashoffset 0.1s linear;
}
.cooldown-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 1em;
  color: #f7c873;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
  text-shadow: 0 0 6px #223, 0 0 2px #fff2;
  pointer-events: none;
}
.version {
  position: fixed;
  bottom: 10px;
  right: 10px;
  color: #b5cfcf;
  font-size: 0.8em;
  opacity: 0.7;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
.peaceful-tip {
  margin: 18px 0 0 0;
  color: #f7c873;
  font-size: 1.1em;
  text-align: center;
  letter-spacing: 1px;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
.reset-layer {
  background: linear-gradient(90deg, #1a2324 60%, #24241a 100%);
  border: 1px solid #7fd7d7;
  border-radius: 10px;
  margin: 30px 0 0 0;
  padding: 18px 24px;
  color: #aee6e6;
  box-shadow: 0 2px 8px #2233;
  max-width: 400px;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
.reset-layer h3 {
  margin-top: 0;
  color: #f7c873;
  font-size: 1.3em;
  letter-spacing: 1px;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
.reset-layer .reset-btn {
  margin-top: 12px;
  background: linear-gradient(90deg, #223233 60%, #3a2333 100%);
  border: 2px solid #f7c873;
  color: #f7c873;
  border-radius: 8px;
  padding: 8px 18px;
  font-size: 1em;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
.reset-layer .reset-btn:disabled {
  opacity: 0.5;
}
.credits {
  color: #b5cfcf;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
.footer {
  color: #f7c873;
  font-family: 'Consolas', 'Menlo', 'Monaco', 'Orbitron', monospace;
}
#saltPpm, #waterVolume, #expPoints, #research {
  font-variant-numeric: tabular-nums;
  font-family: 'Consolas', 'Menlo', 'Monaco', monospace;
  letter-spacing: 0.01em; /* åŸæœ¬ 0.03emï¼Œæ”¹å° */
  min-width: 5.5em;       /* åŸæœ¬ 7.5emï¼Œæ”¹å° */
  display: inline-block;
  text-align: right;
  font-size: 1.3em;       /* åŸæœ¬ 1.5emï¼Œæ”¹å° */
  line-height: 1.2;
  vertical-align: middle;
}
/* åˆ†é åˆ—æ¨£å¼ */
.info-tab-btn {
  border: none;
  outline: none;
  background: none;
  border-radius: 8px 8px 0 0;
  margin: 0 2px 0 0;
  padding: 12px 0 10px 0;
  font-size: 1em;
  cursor: pointer;
  transition: background 0.15s, color 0.15s, box-shadow 0.15s;
  color: #f7c873;
  position: relative;
  z-index: 1;
}
.info-tab-btn[data-tab="special"] {
  color: #ff4444;
  font-weight: bold;
}
.info-tab-btn.active-info-tab {
  background: #223233;
  color: #f7c873;
  z-index: 2;
  box-shadow: 0 -4px 12px #2238;
}
.info-tab-btn[data-tab="special"].active-info-tab {
  background: #400;
  color: #fff;
  box-shadow: 0 -4px 12px #4008;
}
</style>
</head>
<body>
<audio id="bgm" autoplay loop>
  <source src="" type="audio/mpeg"><!-- â† é€™è£¡ src ç•™ç©ºï¼Œæ–¹ä¾¿ä½ è‡ªè¡Œå¡«å¯«éŸ³æ¨‚æª”æ¡ˆè·¯å¾‘ -->
</audio>
<button class="neon-btn language-switch" id="langSwitch">English</button>
<button id="infoBtn" title="èªªæ˜ / Info" style="position:fixed;top:16px;right:48px;z-index:100;font-size:1.2em;padding:4px 12px;border-radius:50%;width:36px;height:36px;line-height:1;background:#223233;color:#f7c873;border:2px solid #f7c873;cursor:pointer;">i</button>
<button class="neon-btn" id="roleBtn" title="ä¸–ç•Œè§€ / Role" style="position:fixed;top:16px;right:92px;z-index:100;font-size:1.2em;padding:4px 12px;border-radius:50%;width:36px;height:36px;line-height:1;background:#223233;color:#f7c873;border:2px solid #f7c873;cursor:pointer;">R</button>
<button class="neon-btn" id="showFormulaBtn" title="å…¬å¼ / Formula" style="position:fixed;top:16px;right:140px;z-index:101;font-size:1.2em;padding:4px 12px;border-radius:50%;width:36px;height:36px;line-height:1;background:#223233;color:#f7c873;border:2px solid #7fd7d7;cursor:pointer;">F</button>
<button class="neon-btn" id="cheatSaltBtn" title="åŠ é¹½ä½œå¼Š" style="position:fixed;top:16px;right:180px;z-index:100;font-size:1.1em;padding:4px 12px;border-radius:8px;background:#223233;color:#f7c873;border:2px solid #f7c873;cursor:pointer;">ğŸ’°é¹½+</button>

<!-- èªªæ˜å½ˆçª—ï¼ˆå¤šåˆ†é ï¼‰ -->
<div id="infoModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:200;align-items:center;justify-content:center;">
  <div style="background:#1a2324;border:2px solid #7fd7d7;border-radius:12px;max-width:420px;min-width:320px;padding:0 0 0 0;color:#aee6e6;box-shadow:0 4px 24px #223b;position:relative;display:flex;flex-direction:column;">
    <button id="closeInfo" style="position:absolute;top:10px;right:14px;background:none;border:none;color:#f7c873;font-size:1.3em;cursor:pointer;z-index:2;">Ã—</button>
    <div style="padding:18px 20px 0 20px;">
      <select id="infoTabSelect" style="width:100%;padding:8px 6px;font-size:1em;border-radius:6px;background:#223233;color:#f7c873;border:1.5px solid #7fd7d7;">
        <option value="howto">ç©æ³•èªªæ˜</option>
        <option value="salt">é¹½åˆ†ç³»çµ±</option>
        <option value="upgrade">å‡ç´š</option>
        <option value="acid">é…¸æ€§æ€ªç‰©</option>
        <option value="special">ç‰¹æ®ŠåŠŸèƒ½</option>
      </select>
    </div>
    <div id="infoTabContent" style="padding:24px 20px 18px 20px;max-height:65vh;overflow-y:auto;">
      <!-- å…§å®¹ç”± JS æ§åˆ¶ -->
    </div>
  </div>
</div>

<!-- æ–°å¢ä¸–ç•Œè§€å½ˆçª— -->
<div id="roleModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:201;align-items:center;justify-content:center;">
  <div style="background:#1a2324;border:2px solid #7fd7d7;border-radius:12px;max-width:480px;min-width:320px;padding:0;color:#aee6e6;box-shadow:0 4px 24px #223b;position:relative;display:flex;flex-direction:column;">
    <button id="closeRole" style="position:absolute;top:10px;right:14px;background:none;border:none;color:#f7c873;font-size:1.3em;cursor:pointer;z-index:2;">Ã—</button>
    <div style="display:flex;border-bottom:1px solid #7fd7d7;">
      <button class="role-tab-btn" data-tab="world" style="flex:1;padding:12px 0;background:none;border:none;color:#f7c873;font-size:1em;cursor:pointer;">ä¸–ç•Œè§€</button>
      <button class="role-tab-btn" data-tab="chapters" style="flex:1;padding:12px 0;background:none;border:none;color:#f7c873;font-size:1em;cursor:pointer;">ç« ç¯€</button>
    </div>
    <div id="roleTabContent" style="padding:24px 20px 18px 20px;max-height:65vh;overflow-y:auto;">
      <!-- å…§å®¹ç”± JS æ§åˆ¶ -->
    </div>
  </div>
</div>

<!-- å…¬å¼é¡¯ç¤ºæŒ‰éˆ• -->
<button class="neon-btn" id="showFormulaBtn" title="å…¬å¼ / Formula" style="position:fixed;top:16px;right:140px;z-index:101;font-size:1.2em;padding:4px 12px;border-radius:50%;width:36px;height:36px;line-height:1;background:#223233;color:#f7c873;border:2px solid #7fd7d7;cursor:pointer;">F</button>
<div id="formulaModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:300;align-items:center;justify-content:center;">
  <div style="background:#1a2324;border:2px solid #7fd7d7;border-radius:12px;max-width:520px;min-width:320px;padding:0 0 0 0;color:#aee6e6;box-shadow:0 4px 24px #223b;position:relative;display:flex;flex-direction:column;">
    <button id="closeFormula" style="position:absolute;top:10px;right:14px;background:none;border:none;color:#f7c873;font-size:1.3em;cursor:pointer;z-index:2;">Ã—</button>
    <div style="padding:24px 28px 24px 28px;max-height:70vh;overflow-y:auto;">
      <div id="formulaContent"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="game-title" data-zh="é¹½é¡å¯¦é©—å®¤" data-en="Salt Laboratory">é¹½é¡å¯¦é©—å®¤</div>
  <div class="game-desc" data-zh="ä½ æ˜¯ä¸€ä½é¹½åˆ†ç ”ç©¶å“¡ï¼Œæ­£åœ¨ç ”ç©¶ä¸åŒé¹½é¡åœ¨æ°´ä¸­çš„æº¶è§£åº¦..." data-en="You are a salt researcher studying the solubility of different salts in water...">ä½ æ˜¯ä¸€ä½é¹½åˆ†ç ”ç©¶å“¡ï¼Œæ­£åœ¨ç ”ç©¶ä¸åŒé¹½é¡åœ¨æ°´ä¸­çš„æº¶è§£åº¦...</div>
  <div class="peaceful-tip" data-zh="æ…¢æ…¢ä¾†ï¼Œäº«å—æ¯ä¸€æ»´æ°´çš„è®ŠåŒ–ã€‚" data-en="Take it slow and enjoy every drop.">æ…¢æ…¢ä¾†ï¼Œäº«å—æ¯ä¸€æ»´æ°´çš„è®ŠåŒ–ã€‚</div>
  
  <!-- é…¸æ€§æ•µäººå€å¡Šï¼Œé è¨­éš±è— -->
  <div id="acidEnemyPanel" style="display:none;margin:24px 0 0 0;padding:16px 18px;background:#2a1a1a;border:2px solid #f77c7c;border-radius:10px;max-width:400px;color:#f7c873;box-shadow:0 2px 8px #4008;">
    <h3 style="margin-top:0;color:#f77c7c;font-size:1.2em;">âš—ï¸ é…¸æ€§æ€ªç‰©</h3>
    <div id="acidStatus" style="margin-bottom:8px;">
      <span data-zh="é…¸æ€§æ€ªç‰©æ­£åœ¨ç ´å£ä½ çš„é¹½åˆ†ï¼é»æ“Šæ€ªç‰©å¯ç²å¾—é…¸æ¶²ã€‚" data-en="Acid monsters are destroying your salt! Click them to get acid.">é…¸æ€§æ€ªç‰©æ­£åœ¨ç ´å£ä½ çš„é¹½åˆ†ï¼é»æ“Šæ€ªç‰©å¯ç²å¾—é…¸æ¶²ã€‚</span>
    </div>
    <div>
      <span data-zh="æ€ªç‰©è¡€é‡ï¼š" data-en="Monster HP: ">æ€ªç‰©è¡€é‡ï¼š</span>
      <span id="acidMonsterHp">100</span> / <span id="acidMonsterHpMax">100</span>
      (<span id="acidMonsterHpPercent">100</span>%)
    </div>
    <div>
      <span data-zh="æ¯ç§’æå¤±é¹½åˆ†ï¼š" data-en="Salt lost per second: ">æ¯ç§’æå¤±é¹½åˆ†ï¼š</span>
      <span id="acidLoss">0.00</span> mg
    </div>
    <div>
      <span data-zh="é…¸æ¶²ï¼š" data-en="Acid: ">é…¸æ¶²ï¼š</span>
      <span id="acidCurrency">0</span>
    </div>
    <button id="attackAcidMonsterBtn" class="neon-btn" style="margin-top:10px;">
      <span data-zh="é»æ“Šæ€ªç‰©ç²å¾—é…¸æ¶²" data-en="Click Monster for Acid">é»æ“Šæ€ªç‰©ç²å¾—é…¸æ¶²</span>
    </button>
    <button id="upgradeAcidMonsterBtn" class="neon-btn" style="margin-top:10px;">
      <span data-zh="å‡ç´šæ€ªç‰©ï¼ˆæ¶ˆè€—é…¸æ¶²ï¼Œé™ä½è¡€é‡ï¼‰" data-en="Upgrade Monster (cost acid, lower HP)">å‡ç´šæ€ªç‰©ï¼ˆæ¶ˆè€—é…¸æ¶²ï¼Œé™ä½è¡€é‡ï¼‰</span>
    </button>
    <div style="margin-top:8px;font-size:0.95em;color:#f7c873;" data-zh="å‡ç´šå¯æ¸›å°‘æ€ªç‰©è¡€é‡ï¼Œé™ä½é¹½åˆ†æå¤±ã€‚" data-en="Upgrade to lower monster HP and reduce salt loss.">å‡ç´šå¯æ¸›å°‘æ€ªç‰©è¡€é‡ï¼Œé™ä½é¹½åˆ†æå¤±ã€‚</div>
  </div>
  <div class="display">
    <div id="energy" style="margin-bottom:0;font-size:2.2em;font-weight:bold;"
      data-zh="å¯¦é©—æ•¸æ“š" data-en="Experiment Data">å¯¦é©—æ•¸æ“š</div>
    <div id="currency-row" style="margin-bottom:20px;">
      <span data-zh="é¹½åˆ†æ¿ƒåº¦ï¼š" data-en="Salt Concentration: ">é¹½åˆ†æ¿ƒåº¦ï¼š</span>
      <span id="saltPpm">0</span> mg/L |
      <span data-zh="å‰©é¤˜æ°´é‡ï¼š" data-en="Water Volume: ">å‰©é¤˜æ°´é‡ï¼š</span>
      <span id="waterVolume">1000</span> L |
      <span data-zh="å¯¦é©—é»æ•¸ï¼š" data-en="Experiment Points: ">å¯¦é©—é»æ•¸ï¼š</span>
      <span id="expPoints">0</span> |
      <span data-zh="ç ”ç©¶é€²åº¦ï¼š" data-en="Research Progress: ">ç ”ç©¶é€²åº¦ï¼š</span>
      <span id="research">0</span>%
      <!-- æ–°å¢ï¼šé¹½åˆ†ç¸½é‡é¡¯ç¤º -->
      | <span data-zh="é¹½åˆ†ç¸½é‡ï¼š" data-en="Total Salt: ">é¹½åˆ†ç¸½é‡ï¼š</span>
      <span id="saltTotal">0</span> mg
    </div>
    <div id="prestigeReqRow" style="margin-top:8px;font-size:1.1em;">
      <span data-zh="ä¸‹æ¬¡ç ”ç©¶éœ€è¦ï¼š" data-en="Next research requires: ">ä¸‹æ¬¡ç ”ç©¶éœ€è¦ï¼š</span>
      <span id="prestigeReqPpm" style="font-family:'Consolas','Menlo','Monaco',monospace;">1000.000</span> mg/L
      <span data-zh="ï¼ˆç›®å‰ï¼š" data-en="(Current: " >ï¼ˆç›®å‰ï¼š</span>
      <span id="currentPpm" style="font-family:'Consolas','Menlo','Monaco',monospace;">0.000</span> mg/L)
    </div>
    <!-- æ–°å¢ï¼šæœ€å¤§é¹½åˆ†æ¿ƒåº¦ç´€éŒ„ -->
    <div id="maxPpmRow" style="margin-top:4px;font-size:0.98em;color:#f7c873;">
      <span data-zh="æ­·å²æœ€é«˜é¹½åˆ†æ¿ƒåº¦ï¼š" data-en="Max Salt Concentration: ">æ­·å²æœ€é«˜é¹½åˆ†æ¿ƒåº¦ï¼š</span>
      <span id="maxSaltPpm">0.000</span> mg/L
    </div>
  </div>
  <div class="upgrade">
    <div class="cooldown-container">
      <button class="neon-btn" id="addSaltBtn">
        <span data-zh="æ·»åŠ é¹½åˆ†" data-en="Add Salt">æ·»åŠ é¹½åˆ†</span>
      </button>
      <div class="cooldown-ring">
        <svg width="60" height="60">
          <circle class="background" cx="30" cy="30" r="27" fill="none"/>
          <circle class="progress" cx="30" cy="30" r="27" fill="none" stroke-dasharray="169.6" stroke-dashoffset="0"/>
        </svg>
        <div class="cooldown-text" id="cooldownText">1000ms</div>
      </div>
    </div>
  </div>
  <div class="upgrade">
    <button class="neon-btn" id="naturalErosionBtn">
      <span data-zh="è‡ªç„¶ä¾µè•" data-en="Natural Erosion">è‡ªç„¶ä¾µè•</span>
      <br>
      <span data-zh="èŠ±è²»ï¼š" data-en="Cost: ">èŠ±è²»ï¼š</span><span class="upgrade-cost" id="naturalErosionCost">0.001</span> mg/L<br>
      <span data-zh="æ•ˆæœï¼š" data-en="Effect: ">æ•ˆæœï¼š</span>
      <span data-zh="æ¯æ¬¡é»æ“Šé¡å¤–å¢åŠ " data-en="Add extra">æ¯æ¬¡é»æ“Šé¡å¤–å¢åŠ </span>
      <span class="upgrade-effect" id="naturalErosionEffect">1.0</span>x
      <span data-zh="é¹½åˆ†" data-en="salt">é¹½åˆ†</span>
    </button>
    <div class="desc">
      <span data-zh="ç•¶å‰ç­‰ç´šï¼š" data-en="Current Level: ">ç•¶å‰ç­‰ç´šï¼š</span>
      <span id="naturalErosionLv">0</span>
    </div>
  </div>
  <div class="upgrade">
    <button class="neon-btn" id="evaporationBtn">
      <span data-zh="è’¸ç™¼" data-en="Evaporation">è’¸ç™¼</span>
      <br>
      <span data-zh="èŠ±è²»ï¼š" data-en="Cost: ">èŠ±è²»ï¼š</span><span class="upgrade-cost" id="evaporationCost">0.001</span> mg/L<br>
      <span data-zh="æ•ˆæœï¼š" data-en="Effect: ">æ•ˆæœï¼š</span>
      <span data-zh="æ¯æ¬¡é»æ“Šæ¸›å°‘" data-en="Reduce">æ¯æ¬¡é»æ“Šæ¸›å°‘</span>
      <span class="upgrade-effect" id="evaporationEffect">1.0</span>L
      <span data-zh="æ°´é‡" data-en="water">æ°´é‡</span>
    </button>
    <div class="desc">
      <span data-zh="ç•¶å‰ç­‰ç´šï¼š" data-en="Current Level: ">ç•¶å‰ç­‰ç´šï¼š</span>
      <span id="evaporationLv">0</span>
    </div>
  </div>
  <div class="upgrade">
    <button class="neon-btn" id="fasterLaborBtn">
      <span data-zh="åŠ é€Ÿå‹å‹•" data-en="Faster Labor">åŠ é€Ÿå‹å‹•</span>
      <br>
      <span data-zh="èŠ±è²»ï¼š" data-en="Cost: ">èŠ±è²»ï¼š</span><span class="upgrade-cost" id="fasterLaborCost">0.001</span> mg/L<br>
      <span data-zh="æ•ˆæœï¼š" data-en="Effect: ">æ•ˆæœï¼š</span>
      <span data-zh="æ¸›å°‘" data-en="Reduce">æ¸›å°‘</span>
      <span class="upgrade-effect" id="fasterLaborEffect">1000</span>ms
      <span data-zh="å†·å»æ™‚é–“" data-en="cooldown">å†·å»æ™‚é–“</span>
    </button>
    <div class="desc">
      <span data-zh="ç•¶å‰ç­‰ç´šï¼š" data-en="Current Level: ">ç•¶å‰ç­‰ç´šï¼š</span>
      <span id="fasterLaborLv">0</span>
    </div>
  </div>
  <div class="upgrade">
    <button class="neon-btn" id="autoDissolveBtn">
      <span data-zh="è‡ªå‹•æº¶è§£" data-en="Auto Dissolve">è‡ªå‹•æº¶è§£</span>
      <br>
      <span data-zh="èŠ±è²»ï¼š" data-en="Cost: ">èŠ±è²»ï¼š</span><span class="upgrade-cost" id="autoDissolveCost">0.001</span> mg/L<br>
      <span data-zh="æ•ˆæœï¼š" data-en="Effect: ">æ•ˆæœï¼š</span>
      <span data-zh="æ¯ç§’è‡ªå‹•æ·»åŠ " data-en="Auto add">æ¯ç§’è‡ªå‹•æ·»åŠ </span>
      <span class="upgrade-effect" id="autoDissolveEffect">0.0</span>/s
      <span data-zh="é¹½åˆ†" data-en="salt">é¹½åˆ†</span>
    </button>
    <div class="desc">
      <span data-zh="ç•¶å‰ç­‰ç´šï¼š" data-en="Current Level: ">ç•¶å‰ç­‰ç´šï¼š</span>
      <span id="autoDissolveLv">0</span>
    </div>
  </div>
  <div class="upgrade">
    <h2 style="margin-top:32px;" data-zh="ç ”ç©¶é€²éš" data-en="Research Progress">ç ”ç©¶é€²éš</h2>
    <div class="prestige-info">
      <div>
        <span data-zh="ç•¶å‰ç ”ç©¶ï¼š" data-en="Current Research: ">ç•¶å‰ç ”ç©¶ï¼š</span>
        <span id="currentResearch">é¹½</span>
      </div>
      <div>
        <span data-zh="ç•¶å‰å€ç‡ï¼š" data-en="Current Multiplier: ">ç•¶å‰å€ç‡ï¼š</span>
        <span id="resetMultiplier">1.0</span>x
      </div>
      <div>
        <span data-zh="ä¸‹æ¬¡ç ”ç©¶ï¼š" data-en="Next Research: ">ä¸‹æ¬¡ç ”ç©¶ï¼š</span>
        <span id="nextResearch">ç³–</span>
      </div>
      <div>
        <span data-zh="é‡ç½®å¾Œç²å¾—ï¼š" data-en="After reset: ">é‡ç½®å¾Œç²å¾—ï¼š</span>
        <span id="nextMultiplier">1.5</span>x
        <span data-zh="å€ç‡" data-en="multiplier">å€ç‡</span>
      </div>
      <div>
        <span data-zh="ä¸‹æ¬¡ç ”ç©¶æ‰€éœ€æ¿ƒåº¦ï¼š" data-en="PPM needed for next research: ">ä¸‹æ¬¡ç ”ç©¶æ‰€éœ€æ¿ƒåº¦ï¼š</span>
        <span id="nextResearchPpm">1000.000</span> mg/L
      </div>
    </div>
    <button class="neon-btn" id="resetBtn"
      data-zh="é‡ç½®ç ”ç©¶"
      data-en="Reset Research">
      é‡ç½®ç ”ç©¶
    </button>
  </div>
  <!-- æ–°å¢æ›´é«˜å±¤çš„é‡ç½®ï¼ˆè¶…è¶Šï¼‰ -->
  <div class="reset-layer" id="superResetLayer">
    <h3 data-zh="ç ”ç©¶çªç ´" data-en="Transcend Reset">ç ”ç©¶çªç ´</h3>
    <div>
      <span data-zh="ç•¶å‰è¶…è¶Šé»æ•¸ï¼š" data-en="Transcend Points: ">ç•¶å‰è¶…è¶Šé»æ•¸ï¼š</span>
      <span id="transcendPoints">0</span>
    </div>
    <div>
      <span data-zh="éœ€è¦æ‰€æœ‰ç ”ç©¶é”åˆ°æœ€å¤§ä¸¦é‡ç½®ï¼š" data-en="Requires all research maxed and reset: ">éœ€è¦æ‰€æœ‰ç ”ç©¶é”åˆ°æœ€å¤§ä¸¦é‡ç½®ï¼š</span>
      <span id="superResetReq" style="color:#b3f0f0">0/5</span>
    </div>
    <button class="reset-btn" id="superResetBtn" data-zh="çªç ´" data-en="Transcend Now" disabled>çªç ´</button>
    <div style="margin-top:10px;font-size:0.95em;color:#b5cfcf;" data-zh="è¶…è¶Šå¾Œå°‡ç²å¾—æ°¸ä¹…åŠ æˆï¼Œä¸¦é‡ç½®æ‰€æœ‰é€²åº¦ã€‚" data-en="Transcend for permanent bonus, resets all progress.">è¶…è¶Šå¾Œå°‡ç²å¾—æ°¸ä¹…åŠ æˆï¼Œä¸¦é‡ç½®æ‰€æœ‰é€²åº¦ã€‚</div>
    <div style="margin-top:14px;color:#ff4444;font-weight:bold;font-size:1em;">
      âš ï¸ è¶…è¶Šæœƒé‡ç½®æ‰€æœ‰é€²åº¦ï¼Œè«‹è¬¹æ…æ“ä½œï¼
    </div>
  </div>
  <div class="credits"
  data-zh="å‡ç´šåç¨±ç”± you_3009 æä¾›"
  data-en="Upgrade names by you_3009">
  å‡ç´šåç¨±ç”± you_3009 æä¾›
</div>
<div class="footer"
  data-zh="Â© 2025 é¹½åˆ†å¯¦é©—å®¤ | ç§‘å­¸æ”¾ç½®éŠæˆ²"
  data-en="Â© 2025 Salt Laboratory | Science Idle Game">
  Â© 2025 é¹½åˆ†å¯¦é©—å®¤ | ç§‘å­¸æ”¾ç½®éŠæˆ²
</div>
<div class="version">v1.11K.5-09p~1!!E</div>
<!-- å¢åŠ ä¸€å€‹ä¸å¯è¦‹çš„ div è®“é é¢å¯ä»¥æ»¾å‹•è¶…éåº•éƒ¨ -->
<div style="height: 120px; pointer-events: none; opacity: 0;"></div>
<script>
// filepath: /workspaces/salty-game2/index.html
window.addEventListener('DOMContentLoaded', function() {
  // å¤šèªè¨€è³‡æ–™
  const langData = {
    zh: {
      title: "é¹½é¡å¯¦é©—å®¤",
      desc: "ä½ æ˜¯ä¸€ä½é¹½åˆ†ç ”ç©¶å“¡ï¼Œæ­£åœ¨ç ”ç©¶ä¸åŒé¹½é¡åœ¨æ°´ä¸­çš„æº¶è§£åº¦...",
      tip: "æ…¢æ…¢ä¾†ï¼Œäº«å—æ¯ä¸€æ»´æ°´çš„è®ŠåŒ–ã€‚",
      info: `
        <b>é¹½åˆ†å¯¦é©—å®¤ç©æ³•èªªæ˜</b><br><br>
        é»æ“Šã€Œæ·»åŠ é¹½åˆ†ã€å¢åŠ é¹½åˆ†æ¿ƒåº¦ (mg/L)ã€‚<br>
        å‡ç´šå¯æå‡å„ç¨®èƒ½åŠ›ã€‚<br>
        ç ”ç©¶é€²éšå¯é‡ç½®ä¸¦ç²å¾—å€ç‡ã€‚<br>
        <br>
        <b>å‡ç´šèªªæ˜ï¼š</b><br>
        <b>è‡ªç„¶ä¾µè•ï¼š</b> æå‡æ¯æ¬¡é»æ“Šæ·»åŠ çš„é¹½åˆ†é‡ã€‚<br>
        <b>è’¸ç™¼ï¼š</b> æ¯æ¬¡é»æ“Šæ¸›å°‘æ°´é‡ï¼Œè®“é¹½åˆ†æ¿ƒåº¦æ›´å¿«ä¸Šå‡ã€‚<br>
        <b>åŠ é€Ÿå‹å‹•ï¼š</b> é™ä½ã€Œæ·»åŠ é¹½åˆ†ã€å†·å»æ™‚é–“ã€‚<br>
        <b>è‡ªå‹•æº¶è§£ï¼š</b> æ¯ç§’è‡ªå‹•å¢åŠ é¹½åˆ†ã€‚<br>
      `,
      world: `
        <b>ä¸–ç•Œè§€</b><br>
        ä½ æ˜¯ä¸€ä½é¹½åˆ†ç ”ç©¶å“¡ï¼Œæ¢ç´¢æ°´èˆ‡é¹½çš„å¥§ç§˜ã€‚<br>
        ä½ çš„ç›®æ¨™æ˜¯ç ”ç©¶ä¸åŒé¹½é¡åœ¨æ°´ä¸­çš„æº¶è§£åº¦ï¼Œä¸¦çªç ´æ¥µé™ã€‚<br>
        <br>
        <b>ç« ç¯€</b><br>
        1. é¹½çš„èµ·é»<br>
        2. ç³–çš„æŒ‘æˆ°<br>
        3. é‰€çš„çªç ´<br>
        4. éˆ£çš„æ·±æ·µ<br>
        5. é‚çš„çµ‚ç« <br>
      `,
      addSalt: "æ·»åŠ é¹½åˆ†",
      naturalErosion: "è‡ªç„¶ä¾µè•",
      evaporation: "è’¸ç™¼",
      fasterLabor: "åŠ é€Ÿå‹å‹•",
      autoDissolve: "è‡ªå‹•æº¶è§£",
      cost: "èŠ±è²»ï¼š",
      effect: "æ•ˆæœï¼š",
      addExtra: "æ¯æ¬¡é»æ“Šé¡å¤–å¢åŠ ",
      reduce: "æ¯æ¬¡é»æ“Šæ¸›å°‘",
      reduceCooldown: "æ¸›å°‘",
      autoAdd: "æ¯ç§’è‡ªå‹•æ·»åŠ ",
      salt: "é¹½åˆ†",
      water: "æ°´é‡",
      cooldown: "å†·å»æ™‚é–“",
      currentLevel: "ç•¶å‰ç­‰ç´šï¼š",
      experimentData: "å¯¦é©—æ•¸æ“š",
      saltConcentration: "é¹½åˆ†æ¿ƒåº¦ï¼š",
      waterVolume: "å‰©é¤˜æ°´é‡ï¼š",
      expPoints: "å¯¦é©—é»æ•¸ï¼š",
      researchProgress: "ç ”ç©¶é€²åº¦ï¼š",
      nextResearchReq: "ä¸‹æ¬¡ç ”ç©¶éœ€è¦ï¼š",
      current: "ï¼ˆç›®å‰ï¼š",
      mgL: "mg/L",
      L: "L",
      s: "/s",
      ms: "ms",
      multiplier: "å€ç‡",
      currentResearch: "ç•¶å‰ç ”ç©¶ï¼š",
      currentMultiplier: "ç•¶å‰å€ç‡ï¼š",
      nextResearch: "ä¸‹æ¬¡ç ”ç©¶ï¼š",
      afterReset: "é‡ç½®å¾Œç²å¾—ï¼š",
      nextResearchPpm: "ä¸‹æ¬¡ç ”ç©¶æ‰€éœ€æ¿ƒåº¦ï¼š",
      resetResearch: "é‡ç½®ç ”ç©¶",
      transcendReset: "ç ”ç©¶çªç ´",
      transcendPoints: "ç•¶å‰è¶…è¶Šé»æ•¸ï¼š",
      transcendReq: "éœ€è¦æ‰€æœ‰ç ”ç©¶é”åˆ°æœ€å¤§ä¸¦é‡ç½®ï¼š",
      transcendNow: "çªç ´",
      transcendTip: "è¶…è¶Šå¾Œå°‡ç²å¾—æ°¸ä¹…åŠ æˆï¼Œä¸¦é‡ç½®æ‰€æœ‰é€²åº¦ã€‚",
      transcendWarn: "âš ï¸ è¶…è¶Šæœƒé‡ç½®æ‰€æœ‰é€²åº¦ï¼Œè«‹è¬¹æ…æ“ä½œï¼",
      upgradeBy: "å‡ç´šåç¨±ç”± you_3009 æä¾›",
      copyright: "Â© 2025 é¹½åˆ†å¯¦é©—å®¤ | ç§‘å­¸æ”¾ç½®éŠæˆ²"
    },
    en: {
      title: "Salt Laboratory",
      desc: "You are a salt researcher studying the solubility of different salts in water...",
      tip: "Take it slow and enjoy every drop.",
      info: `
        <b>How to Play Salt Laboratory</b><br><br>
        Click "Add Salt" to increase salt concentration (mg/L).<br>
        Upgrades improve various abilities.<br>
        Research progress allows reset for multipliers.<br>
        <br>
        <b>Upgrade Description:</b><br>
        <b>Natural Erosion:</b> Increases salt per click.<br>
        <b>Evaporation:</b> Reduces water per click, raising salt concentration faster.<br>
        <b>Faster Labor:</b> Reduces "Add Salt" cooldown.<br>
        <b>Auto Dissolve:</b> Adds salt automatically every second.<br>
      `,
      world: `
        <b>Worldview</b><br>
        You are a salt researcher exploring the mysteries of water and salt.<br>
        Your goal is to study the solubility of different salts in water and break through the limits.<br>
        <br>
        <b>Chapters</b><br>
        1. The Beginning of Salt<br>
        2. The Challenge of Sugar<br>
        3. The Breakthrough of Potassium<br>
        4. The Abyss of Calcium<br>
        5. The Finale of Magnesium<br>
      `,
      addSalt: "Add Salt",
      naturalErosion: "Natural Erosion",
      evaporation: "Evaporation",
      fasterLabor: "Faster Labor",
      autoDissolve: "Auto Dissolve",
      cost: "Cost: ",
      effect: "Effect: ",
      addExtra: "Add extra",
      reduce: "Reduce",
      reduceCooldown: "Reduce",
      autoAdd: "Auto add",
      salt: "salt",
      water: "water",
      cooldown: "cooldown",
      currentLevel: "Current Level: ",
      experimentData: "Experiment Data",
      saltConcentration: "Salt Concentration: ",
      waterVolume: "Water Volume: ",
      expPoints: "Experiment Points: ",
      researchProgress: "Research Progress: ",
      nextResearchReq: "Next research requires: ",
      current: "(Current: ",
      mgL: "mg/L",
      L: "L",
      s: "/s",
      ms: "ms",
      multiplier: "multiplier",
      currentResearch: "Current Research: ",
      currentMultiplier: "Current Multiplier: ",
      nextResearch: "Next Research: ",
      afterReset: "After reset: ",
      nextResearchPpm: "PPM needed for next research: ",
      resetResearch: "Reset Research",
      transcendReset: "Transcend Reset",
      transcendPoints: "Transcend Points: ",
      transcendReq: "Requires all research maxed and reset: ",
      transcendNow: "Transcend Now",
      transcendTip: "Transcend for permanent bonus, resets all progress.",
      transcendWarn: "âš ï¸ Transcend will reset all progress. Be careful!",
      upgradeBy: "Upgrade names by you_3009",
      copyright: "Â© 2025 Salt Laboratory | Science Idle Game"
    }
  };

  // ç•¶å‰èªè¨€
  let currentLang = "zh";

  // å‡ç´šç­‰ç´š
  let naturalErosionLv = 0;
  let evaporationLv = 0;
  let fasterLaborLv = 0;
  let autoDissolveLv = 0;

  // ä¸»è¦æ•¸å€¼
  let saltMg = 0; // é¹½åˆ†ç¸½é‡ (mg)
  let waterVolume = 1000; // æ°´é‡ (L)
  let expPoints = 0;
  let research = 0;
  let clickCooldown = 1000;
  let lastClickTime = 0;

  // ç ”ç©¶ç‰©è³ªåç¨±
  const compounds = [
    { zh: "æ°¯åŒ–éˆ‰ (NaCl)", en: "Sodium Chloride (NaCl)" },
    { zh: "ç¡é…¸é‰€ (KNOâ‚ƒ)", en: "Potassium Nitrate (KNOâ‚ƒ)" },
    { zh: "ç¡«é…¸é‚ (MgSOâ‚„)", en: "Magnesium Sulfate (MgSOâ‚„)" },
    { zh: "é†‹é…¸éˆ‰ (CHâ‚ƒCOONa)", en: "Sodium Acetate (CHâ‚ƒCOONa)" },
    { zh: "ç¢³é…¸éˆ‰ (Naâ‚‚COâ‚ƒ)", en: "Sodium Carbonate (Naâ‚‚COâ‚ƒ)" },
    { zh: "æ°¯åŒ–é‰€ (KCl)", en: "Potassium Chloride (KCl)" },
    { zh: "ç¡«é…¸éŠ¨ ((NHâ‚„)â‚‚SOâ‚„)", en: "Ammonium Sulfate ((NHâ‚„)â‚‚SOâ‚„)" },
    { zh: "ç¡é…¸éˆ‰ (NaNOâ‚ƒ)", en: "Sodium Nitrate (NaNOâ‚ƒ)" },
    { zh: "æ°¯åŒ–éˆ£ (CaClâ‚‚)", en: "Calcium Chloride (CaClâ‚‚)" },
    { zh: "ç¡«é…¸éˆ‰ (Naâ‚‚SOâ‚„)", en: "Sodium Sulfate (Naâ‚‚SOâ‚„)" }
  ];
  let currentCompound = 0;

  // æ–°å¢ï¼šæœ€é«˜é¹½åˆ†æ¿ƒåº¦ç´€éŒ„
  let maxSaltPpm = 0;

  // æ•¸å€¼å‹•ç•«æ•ˆæœ
  function animateValue(id, newValue) {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.remove('animated');
    void el.offsetWidth; // è§¸ç™¼é‡ç¹ª
    el.classList.add('animated');
    el.textContent = newValue;
  }

  // å‡ç´šå‹•ç•«æ•ˆæœ
  function animateUpgradeBtn(id) {
    const btn = document.getElementById(id);
    if (!btn) return;
    btn.classList.remove('upgraded');
    void btn.offsetWidth;
    btn.classList.add('upgraded');
    setTimeout(() => btn.classList.remove('upgraded'), 500);
  }

  function updateDisplay() {
    // ç›´æ¥ç”¨ saltMg / waterVolume è¨ˆç®—é¹½åˆ†æ¿ƒåº¦
    // åŸæœ¬ï¼šif (waterVolume < 1) waterVolume = 1;
    if (waterVolume < 50) waterVolume = 50;
    let ppm = saltMg / waterVolume;
    animateValue('saltPpm', ppm.toFixed(3));
    animateValue('waterVolume', waterVolume.toFixed(1));
    animateValue('expPoints', expPoints);
    animateValue('saltTotal', saltMg.toFixed(2));
    // æ–°å¢ï¼šæœ€é«˜é¹½åˆ†æ¿ƒåº¦ç´€éŒ„
    if (ppm > maxSaltPpm) maxSaltPpm = ppm;
    animateValue('maxSaltPpm', maxSaltPpm.toFixed(3));
    // ç ”ç©¶é€²åº¦
    animateValue('research', research);
    // é¡¯ç¤ºåŒ–åˆç‰©åç¨±
    if (document.getElementById('currentResearch'))
      document.getElementById('currentResearch').textContent = compounds[currentCompound][currentLang];
    if (document.getElementById('nextResearch') && compounds[currentCompound + 1])
      document.getElementById('nextResearch').textContent = compounds[currentCompound + 1][currentLang];
    updateUpgradeButtons();
    updateResearchUI();
  }

  function updateUpgradeButtons() {
    let ppm = waterVolume > 0 ? saltMg / waterVolume : 0;
    document.getElementById('naturalErosionEffect').textContent = getNaturalErosionMult().toFixed(1);
    document.getElementById('naturalErosionLv').textContent = naturalErosionLv;
    document.getElementById('evaporationEffect').textContent = getEvaporationAmount().toFixed(1);
    document.getElementById('evaporationLv').textContent = evaporationLv;
    document.getElementById('fasterLaborEffect').textContent = getFasterLaborCooldown().toFixed(0);
    document.getElementById('fasterLaborLv').textContent = fasterLaborLv;
    // é¡¯ç¤ºæ¯ç§’è‡ªå‹•æ·»åŠ çš„ mg
    document.getElementById('autoDissolveEffect').textContent = getAutoDissolvePerSec().toFixed(1);
    document.getElementById('autoDissolveLv').textContent = autoDissolveLv;
    document.getElementById('naturalErosionCost').textContent = getUpgradeCost(naturalErosionLv, 'normal').toFixed(3) + " mg/L";
    document.getElementById('evaporationCost').textContent = getUpgradeCost(evaporationLv, 'normal').toFixed(3) + " mg/L";
    let fasterLaborCost = getUpgradeCost(fasterLaborLv, 'faster');
    document.getElementById('fasterLaborCost').textContent =
      (fasterLaborCost >= 100000 ? fasterLaborCost.toExponential(3) : fasterLaborCost.toFixed(3)) + " mg/L";
    document.getElementById('autoDissolveCost').textContent = getUpgradeCost(autoDissolveLv, 'auto').toFixed(3) + " mg/L";
    document.getElementById('naturalErosionBtn').disabled = ppm < getUpgradeCost(naturalErosionLv, 'normal');
    document.getElementById('evaporationBtn').disabled = ppm < getUpgradeCost(evaporationLv, 'normal');
    document.getElementById('fasterLaborBtn').disabled = ppm < fasterLaborCost;
    document.getElementById('autoDissolveBtn').disabled = ppm < getUpgradeCost(autoDissolveLv, 'auto');
  }

  function getUpgradeCost(lv, type) { 
    let base = 0.001;
    let multi = 2;
    if (type === 'auto') multi = 10;
    // fasterLabor ä½¿ç”¨ 15 å€
    if (type === 'faster') multi = 15;
    return base * Math.pow(multi, lv);
  }
  function getNaturalErosionMult() { 
    // é»æ“ŠåŸºç¤å€ç‡æé«˜
    return 50 + naturalErosionLv * 100; 
  }
  function getEvaporationAmount() { return 1 + evaporationLv * 2.5; }
  function getFasterLaborCooldown() { return Math.max(50, 1000 - fasterLaborLv * 180); }
  function getEffectiveWaterVolume() {
    // è‹¥æ°´é‡ä½æ–¼ 50Lï¼Œé€²è¡Œ softcapï¼Œé¿å…é¹½åˆ†ç”¢é‡çˆ†ç‚¸
    if (waterVolume < 50) {
      // è®“æœ‰æ•ˆæ°´é‡ = 50 * (waterVolume / 50)^0.5ï¼Œè¶Šä½è¶Šé›£é™
      return Math.max(1, 50 * Math.pow(waterVolume / 50, 0.5));
    }
    return waterVolume;
  }
  function getSaltAddAmount() {
    // æ¯æ¬¡é»æ“Šå¯¦éš›æ·»åŠ çš„é¹½åˆ†é‡ï¼ˆmgï¼‰
    let addPpm = 0.001 * getNaturalErosionMult();
    let addAmount = addPpm * getEffectiveWaterVolume();
    return addAmount;
  }

  function getAutoDissolvePerSec() {
    // å…¬å¼ï¼šé¹½åˆ†æ·»åŠ é‡ * (1000/é»æ“Šå†·å»ms) * (1000/å‰©é¤˜æ°´é‡) * (0.3*è‡ªå‹•æº¶è§£ç­‰ç´š)
    if (autoDissolveLv === 0) return 0;
    let saltAddAmount = getSaltAddAmount();
    let cooldown = getFasterLaborCooldown(); // ms
    let L = getEffectiveWaterVolume();
    let perLv = 0.3 * autoDissolveLv;
    return saltAddAmount * (1000 / cooldown) * (1000 / L) * perLv;
  }

  // --- ç ”ç©¶é€²éšèˆ‡è¶…è¶Šé‡ç½®é‚è¼¯ ---

  // ç ”ç©¶å€ç‡èˆ‡é–€æª»
  let resetMultiplier = 1.0;
  let nextMultiplier = 1.5;
  const researchThresholds = [1000, 2000, 4000, 8000, 16000, 32000, 64000, 128000, 256000, 512000];

  // æ›´æ–°ç ”ç©¶é€²åº¦é¡¯ç¤º
  function updateResearchUI() {
    // ç ”ç©¶é€²åº¦ç™¾åˆ†æ¯”
    let ppm = waterVolume > 0 ? saltMg / waterVolume : 0;
    let req = researchThresholds[currentCompound] || 1000;
    let percent = Math.min(100, (ppm / req) * 100);
    document.getElementById('research').textContent = percent.toFixed(1);
    document.getElementById('prestigeReqPpm').textContent = req.toFixed(3);
    document.getElementById('nextResearchPpm').textContent = req.toFixed(3);
    document.getElementById('resetMultiplier').textContent = resetMultiplier.toFixed(1);
    document.getElementById('nextMultiplier').textContent = nextMultiplier.toFixed(1);
    // è¶…è¶Šæ¢ä»¶é¡¯ç¤º
    document.getElementById('superResetReq').textContent = `${currentCompound}/${compounds.length}`;
    // è¶…è¶ŠæŒ‰éˆ•å•Ÿç”¨æ¢ä»¶
    document.getElementById('superResetBtn').disabled = !(currentCompound >= compounds.length - 1);
  }

  // é»æ“Šæ·»åŠ é¹½åˆ†æ™‚çµ¦å¯¦é©—é»æ•¸
  const oldAddSalt = document.getElementById('addSaltBtn').onclick;
  document.getElementById('addSaltBtn').onclick = function() {
    // å†·å»åˆ¤æ–·
    const now = Date.now();
    if (now - lastClickTime < getFasterLaborCooldown()) return;
    lastClickTime = now;

    // è¨ˆç®—æ·»åŠ é¹½åˆ†é‡
    const addAmount = getSaltAddAmount();
    saltMg += addAmount * resetMultiplier; // ç ”ç©¶å€ç‡åŠ æˆ
    // æ‰£é™¤æ°´é‡
    waterVolume = Math.max(0, waterVolume - getEvaporationAmount());
    // å¢åŠ å¯¦é©—é»æ•¸
    expPoints += 1;

    animateUpgradeBtn('addSaltBtn');
    updateDisplay();
  };

  // ç ”ç©¶é‡ç½®
  document.getElementById('resetBtn').onclick = function() {
    let ppm = waterVolume > 0 ? saltMg / waterVolume : 0;
    let req = researchThresholds[currentCompound] || 1000;
    if (ppm < req) return;
    // é€²éšåˆ°ä¸‹ä¸€å€‹åŒ–å­¸ç‰©è³ª
    if (currentCompound < compounds.length - 1) {
      currentCompound++;
      saltMg = 0;
      waterVolume = 1000;
      naturalErosionLv = 0;
      evaporationLv = 0;
      fasterLaborLv = 0;
      autoDissolveLv = 0;
      resetMultiplier = nextMultiplier;
      nextMultiplier = (nextMultiplier * 1.5).toFixed(2) * 1;
      expPoints = 0;
      updateDisplay();
      updateResearchUI();
    }
  };

  // è¶…è¶Šé‡ç½®
  document.getElementById('superResetBtn').onclick = function() {
    // å½ˆçª—è©¢å•
    const msg = currentLang === "zh"
      ? "å¦‚æœï¼Œæˆ‘é€šé›»æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ"
      : "What will happen if I electrify it?";
    if (!window.confirm(msg)) return;
    if (currentCompound < compounds.length - 1) return;
    // é‡ç½®æ‰€æœ‰é€²åº¦ä¸¦çµ¦è¶…è¶Šé»æ•¸
    currentCompound = 0;
    saltMg = 0;
    waterVolume = 1000;
    naturalErosionLv = 0;
    evaporationLv = 0;
    fasterLaborLv = 0;
    autoDissolveLv = 0;
    resetMultiplier = 1.0;
    nextMultiplier = 1.5;
    expPoints = 0;
    // è¶…è¶Šé»æ•¸å¯è‡ªè¡Œè¨­è¨ˆ
    let transcend = parseInt(document.getElementById('transcendPoints').textContent) || 0;
    document.getElementById('transcendPoints').textContent = transcend + 1;
    updateDisplay();
    updateResearchUI();
  };

  // è‡ªç„¶ä¾µè•å‡ç´š
  document.getElementById('naturalErosionBtn').onclick = function() {
    let ppm = waterVolume > 0 ? saltMg / waterVolume : 0;
    let cost = getUpgradeCost(naturalErosionLv, 'normal');
    if (ppm < cost) return;
    saltMg -= cost * waterVolume;
    naturalErosionLv++;
    animateUpgradeBtn('naturalErosionBtn');
    updateDisplay();
  };
  // è’¸ç™¼å‡ç´š
  document.getElementById('evaporationBtn').onclick = function() {
    let ppm = waterVolume > 0 ? saltMg / waterVolume : 0;
    let cost = getUpgradeCost(evaporationLv, 'normal');
    if (ppm < cost) return;
    saltMg -= cost * waterVolume;
    evaporationLv++;
    animateUpgradeBtn('evaporationBtn');
    updateDisplay();
  };
  // åŠ é€Ÿå‹å‹•å‡ç´š
  document.getElementById('fasterLaborBtn').onclick = function() {
    let ppm = waterVolume > 0 ? saltMg / waterVolume : 0;
    let cost = getUpgradeCost(fasterLaborLv, 'faster');
    if (ppm < cost) return;
    saltMg -= cost * waterVolume;
    fasterLaborLv++;
    animateUpgradeBtn('fasterLaborBtn');
    updateDisplay();
    startCooldownLoop(); // å†·å»è®Šæ›´æ™‚é‡å•Ÿå†·å»å‹•ç•«
  };
  // è‡ªå‹•æº¶è§£å‡ç´š
  document.getElementById('autoDissolveBtn').onclick = function() {
    let ppm = waterVolume > 0 ? saltMg / waterVolume : 0;
    let cost = getUpgradeCost(autoDissolveLv, 'auto');
    if (ppm < cost) return;
    saltMg -= cost * waterVolume;
    autoDissolveLv++;
    animateUpgradeBtn('autoDissolveBtn');
    updateDisplay();
  };

  // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
  updateResearchUI();
  // translateAll åªæ›´æ–°æ–‡å­—ï¼Œä¸è¦ç”¨ innerHTML ç›´æ¥è¦†è“‹æŒ‰éˆ•
  function translateAll() {
    const lang = langData[currentLang];
    // 1. ç›´æ¥è¦†è“‹æ‰€æœ‰æœ‰ data-zh/data-en çš„å…ƒç´ 
    document.querySelectorAll('[data-zh][data-en]').forEach(el => {
      el.textContent = el.getAttribute(currentLang === 'zh' ? 'data-zh' : 'data-en');
    });
    // 2. é‡å°ç‰¹æ®Šå€å¡Šï¼ˆå¦‚ footerã€creditsã€versionï¼‰ç›´æ¥è¦†è“‹
    const credits = document.querySelector('.credits');
    if (credits) credits.textContent = lang.upgradeBy;
    const footer = document.querySelector('.footer');
    if (footer) footer.textContent = lang.copyright;
    // 3. å…¶ä»–å‹•æ…‹å…§å®¹ï¼ˆå¦‚å½ˆçª—ï¼‰ä¹Ÿç›´æ¥è¦†è“‹
    document.getElementById('langSwitch').textContent = currentLang === "zh" ? "English" : "ä¸­æ–‡";
    document.title = lang.title;
  }

  // å½ˆçª—é–‹é—œ
  document.getElementById('infoBtn').onclick = function() {
    document.getElementById('infoModal').style.display = 'flex';
    document.getElementById('infoTabSelect').value = 'howto';
    document.getElementById('infoTabContent').innerHTML = langData[currentLang].info;
  };
  document.getElementById('closeInfo').onclick = function() {
    document.getElementById('infoModal').style.display = 'none';
  };
  document.getElementById('roleBtn').onclick = function() {
    document.getElementById('roleModal').style.display = 'flex';
    // å‹•æ…‹æ’å…¥ç›®å‰åŒ–åˆç‰©åç¨±
    const compoundName = compounds[currentCompound][currentLang];
    document.getElementById('roleTabContent').innerHTML =
      `<b>${compoundName}</b><br><br>` + langData[currentLang].world;
  };
  document.getElementById('closeRole').onclick = function() {
    document.getElementById('roleModal').style.display = 'none';
  };

  // æ–°å¢åˆ†é åˆ‡æ›äº‹ä»¶
  document.getElementById('infoTabSelect').onchange = function() {
    const val = this.value;
    let html = '';
    if (val === 'howto') html = langData[currentLang].info;
    else if (val === 'salt') html = "<b>é¹½åˆ†ç³»çµ±èªªæ˜</b><br>ï¼ˆè«‹è‡ªè¡Œè£œå……å…§å®¹ï¼‰";
    else if (val === 'upgrade') html = "<b>å‡ç´šèªªæ˜</b><br>ï¼ˆè«‹è‡ªè¡Œè£œå……å…§å®¹ï¼‰";
    else if (val === 'acid') html = "<b>é…¸æ€§æ€ªç‰©èªªæ˜</b><br>ï¼ˆè«‹è‡ªè¡Œè£œå……å…§å®¹ï¼‰";
    else if (val === 'special') html = "<b>ç‰¹æ®ŠåŠŸèƒ½èªªæ˜</b><br>ï¼ˆè«‹è‡ªè¡Œè£œå……å…§å®¹ï¼‰";
    document.getElementById('infoTabContent').innerHTML = html;
  };

  // å¤šèªè¨€åˆ‡æ›
  document.getElementById('langSwitch').onclick = function() {
    currentLang = (currentLang === "zh") ? "en" : "zh";
    document.getElementById('langSwitch').textContent = currentLang === "zh" ? "English" : "ä¸­æ–‡";
    translateAll();
  };

  // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–èªè¨€
  translateAll();
  updateDisplay();

  // --- å½©è›‹ï¼šæ»‘éåº•éƒ¨é¡¯ç¤º :) ä¸¦è‡ªå‹•æ»¾å›é ‚éƒ¨ ---
  let easterEggShown = false;
  window.addEventListener('scroll', function() {
    if (easterEggShown) return;
    // å…è¨±ç”¨æˆ¶ã€Œæ»‘éã€åº•éƒ¨ä¸€é»æ‰è§¸ç™¼
    if ((window.innerHeight + window.scrollY) > document.body.offsetHeight + 30) {
      easterEggShown = true;
      // å»ºç«‹æç¤ºå…ƒç´ 
      const egg = document.createElement('div');
      egg.textContent = '( Í¡Â° ÍœÊ– Í¡Â°)';
      egg.style.position = 'fixed';
      egg.style.bottom = '40px';
      egg.style.left = '50%';
      egg.style.transform = 'translateX(-50%)';
      egg.style.background = '#223233';
      egg.style.color = '#f7c873';
      egg.style.fontSize = '2.5em';
      egg.style.padding = '16px 32px';
      egg.style.borderRadius = '16px';
      egg.style.boxShadow = '0 4px 24px #223b';
      egg.style.zIndex = '9999';
      egg.style.opacity = '0.95';
      document.body.appendChild(egg);

      setTimeout(() => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
        setTimeout(() => {
          egg.remove();
          easterEggShown = false;
        }, 1200);
      }, 900);
    }
  });

  // å…¬å¼èªªæ˜å…§å®¹
const formulaText = `
<b>éŠæˆ²ä¸»è¦å…¬å¼èªªæ˜ï¼š</b><br><br>
<b>1. æ·»åŠ é¹½åˆ†é‡ï¼š</b><br>
æ¯æ¬¡é»æ“Šæ·»åŠ é¹½åˆ† = <code>0.001 Ã— (50 + è‡ªç„¶ä¾µè•ç­‰ç´š Ã— 100) Ã— max(75, å‰©é¤˜æ°´é‡)</code><br>
èªªæ˜ï¼šè‡ªç„¶ä¾µè•ç­‰ç´šè¶Šé«˜ï¼Œæ¯æ¬¡é»æ“Šæ·»åŠ çš„é¹½åˆ†è¶Šå¤šï¼Œæ°´é‡è¶Šå¤šæ™‚æ·»åŠ é‡ä¹Ÿè¶Šå¤šï¼ˆæœ€ä½ä»¥75Lè¨ˆï¼‰ã€‚<br><br>
<b>2. è’¸ç™¼ï¼ˆæ¯æ¬¡é»æ“Šæ‰£æ°´ï¼‰ï¼š</b><br>
æ¯æ¬¡é»æ“Šæ¸›å°‘æ°´é‡ = <code>1 + è’¸ç™¼ç­‰ç´š Ã— 2.5</code><br>
èªªæ˜ï¼šç­‰ç´šè¶Šé«˜ï¼Œæ¯æ¬¡é»æ“Šæ‰£çš„æ°´è¶Šå¤šã€‚<br><br>
<b>3. æ·»åŠ é¹½åˆ†å†·å»ï¼š</b><br>
å†·å»æ™‚é–“(ms) = <code>max(50, 1000 - åŠ é€Ÿå‹å‹•ç­‰ç´š Ã— 180)</code><br>
èªªæ˜ï¼šç­‰ç´šè¶Šé«˜ï¼Œå†·å»è¶ŠçŸ­ï¼Œæœ€çŸ­50msã€‚<br><br>
<b>4. è‡ªå‹•æº¶è§£ï¼š</b><br>
æ¯ç§’è‡ªå‹•æ·»åŠ é¹½åˆ† = <code>é¹½åˆ†æ·»åŠ é‡ Ã— (1000/é»æ“Šå†·å»ms) Ã— (1000/å‰©é¤˜æ°´é‡) Ã— (0.3*è‡ªå‹•æº¶è§£ç­‰ç´š)</code><br>
èªªæ˜ï¼šç­‰ç´šè¶Šé«˜è‡ªå‹•æ·»åŠ è¶Šå¤šï¼Œæ°´é‡è¶Šå°‘è‡ªå‹•æ·»åŠ è¶Šå¿«ã€‚<br><br>
<b>5. ç ”ç©¶é€²åº¦ç™¾åˆ†æ¯”ï¼š</b><br>
<code>min(100, (é¹½åˆ†æ¿ƒåº¦ / ç•¶å‰é–€æª») Ã— 100)</code><br>
èªªæ˜ï¼šé”åˆ°é–€æª»å³å¯é€²è¡Œç ”ç©¶é‡ç½®ã€‚<br><br>
<b>6. å‡ç´šèŠ±è²»ï¼š</b><br>
<code>0.001 Ã— å€ç‡^ç­‰ç´š</code>ï¼Œå€ç‡ä¾å‡ç´šé¡å‹ä¸åŒï¼ˆè‡ªç„¶ä¾µè•/è’¸ç™¼2å€ï¼Œè‡ªå‹•æº¶è§£10å€ï¼ŒåŠ é€Ÿå‹å‹•15å€ï¼‰<br>
`;

document.getElementById('showFormulaBtn').onclick = function() {
  document.getElementById('formulaContent').innerHTML = formulaText;
  document.getElementById('formulaModal').style.display = 'flex';
};
document.getElementById('closeFormula').onclick = function() {
  document.getElementById('formulaModal').style.display = 'none';
};

// --- å†·å»åœˆå‹•ç•« ---
let cooldownTimer = null;
function updateCooldownRing() {
  const cooldown = getFasterLaborCooldown();
  const now = Date.now();
  const elapsed = now - lastClickTime;
  const percent = Math.max(0, Math.min(1, elapsed / cooldown));
  // 169.6 æ˜¯åœ“å‘¨é•·
  const offset = 169.6 * (1 - percent);
  document.querySelector('.cooldown-ring .progress').setAttribute('stroke-dashoffset', offset);
  document.getElementById('cooldownText').textContent = `${Math.max(0, Math.ceil(cooldown - elapsed))}ms`;
  // å‹•ç•«çµæŸæ™‚è‡ªå‹•å›å¾©é¡è‰²
  if (percent >= 1) {
    document.querySelector('.cooldown-ring .progress').style.stroke = "#7fd7d7";
  } else {
    document.querySelector('.cooldown-ring .progress').style.stroke = "#f7c873";
  }
}
function startCooldownLoop() {
  if (cooldownTimer) clearInterval(cooldownTimer);
  cooldownTimer = setInterval(updateCooldownRing, 30);
}
startCooldownLoop();

// è‡ªå‹•æº¶è§£æ•ˆæœ
setInterval(function() {
  if (autoDissolveLv > 0) {
    // åªæ›´æ–°æ•¸å€¼ï¼Œä¸è§¸ç™¼å‹•ç•«
    let saltAdd = getAutoDissolvePerSec() * resetMultiplier / 10; // æ¯100msåŠ 1/10
    saltMg += saltAdd;
    // åªæ›´æ–°å…§å®¹ï¼Œä¸å‘¼å« animateValue
    document.getElementById('saltPpm').textContent = (saltMg / waterVolume).toFixed(3);
    document.getElementById('saltTotal').textContent = saltMg.toFixed(2);
    // æœ€é«˜é¹½åˆ†æ¿ƒåº¦ç´€éŒ„
    let ppm = saltMg / waterVolume;
    if (ppm > maxSaltPpm) maxSaltPpm = ppm;
    document.getElementById('maxSaltPpm').textContent = maxSaltPpm.toFixed(3);
    // ç ”ç©¶é€²åº¦
    document.getElementById('research').textContent = research;
    // å…¶é¤˜é¡¯ç¤º
    updateUpgradeButtons();
    updateResearchUI();
  }
}, 100);

// --- 20 æ¢éš¨æ©Ÿè¼ªæ’­é‡‘å¥ ---
const peacefulQuotes = [
  "æ…¢æ…¢ä¾†ï¼Œäº«å—æ¯ä¸€æ»´æ°´çš„è®ŠåŒ–ã€‚",
  "ç§‘å­¸éœ€è¦è€å¿ƒï¼Œé¹½åˆ†ä¹Ÿä¸€æ¨£ã€‚",
  "æ¯ä¸€æ¬¡é»æ“Šï¼Œéƒ½æ˜¯é€²æ­¥ã€‚",
  "è§€å¯Ÿç´°ç¯€ï¼Œç™¼ç¾å¥‡è¹Ÿã€‚",
  "é¹½èˆ‡æ°´çš„æ•…äº‹ï¼Œç„¡çª®ç„¡ç›¡ã€‚",
  "éœå¿ƒç­‰å¾…ï¼Œå¯¦é©—æœƒçµ¦ä½ ç­”æ¡ˆã€‚",
  "æ¯ä¸€æ»´æ°´éƒ½å€¼å¾—çæƒœã€‚",
  "ç ”ç©¶çš„è·¯ä¸Šï¼Œåˆ¥å¿˜äº†ä¼‘æ¯ã€‚",
  "æ•¸æ“šæœƒèªªè©±ï¼Œè€å¿ƒæœƒæ”¶ç©«ã€‚",
  "è®“é¹½åˆ†å¸¶ä½ æ¢ç´¢æœªçŸ¥ã€‚",
  "ä¸€é»ä¸€æ»´ï¼Œéƒ½æ˜¯ç©ç´¯ã€‚",
  "ç§‘å­¸çš„ç¾ï¼Œåœ¨æ–¼ç™¼ç¾ã€‚",
  "åˆ¥æ€¥ï¼Œæ…¢æ…¢ä¾†æ‰æœ‰è¶£ã€‚",
  "æ¯å€‹å¯¦é©—éƒ½æ˜¯æ–°çš„é–‹å§‹ã€‚",
  "äº«å—éç¨‹ï¼Œçµæœè‡ªç„¶æœƒä¾†ã€‚",
  "é¹½åˆ†çš„ä¸–ç•Œï¼Œå€¼å¾—ç´°ç´°å“å‘³ã€‚",
  "æ”¾æ…¢è…³æ­¥ï¼Œè§€å¯Ÿè®ŠåŒ–ã€‚",
  "æ¯æ¬¡å˜—è©¦éƒ½å¾ˆé‡è¦ã€‚",
  "ç›¸ä¿¡è‡ªå·±ï¼Œä¹Ÿç›¸ä¿¡æ•¸æ“šã€‚",
  "æ°´èˆ‡é¹½ï¼Œéƒ½æ˜¯ç”Ÿæ´»çš„è—è¡“ã€‚"
];
let quoteIdx = 0;
const tipEl = document.querySelector('.peaceful-tip');
function rotateQuote() {
  tipEl.textContent = peacefulQuotes[quoteIdx];
  quoteIdx = (quoteIdx + 1) % peacefulQuotes.length;
}
rotateQuote();
setInterval(rotateQuote, 10000);

  // æ–°å¢ä½œå¼ŠæŒ‰éˆ•åŠŸèƒ½
  document.getElementById('cheatSaltBtn').onclick = function() {
    saltMg = 1000000;
    updateDisplay();
    alert("é¹½åˆ†å·²è¨­ç‚º 1000000 mgï¼");
  };
});
</script>
</body>
</html>
